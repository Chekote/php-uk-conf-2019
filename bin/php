#!/usr/bin/env bash

# Ensure that the ~/.composer folder exists before trying to mount it
if [ ! -d "${PATH_PREFIX}${HOME}/.composer" ]; then
  mkdir "${PATH_PREFIX}${HOME}/.composer"
fi

if [[ `uname` == 'MINGW64_NT-10.0'* ]]; then
  # winpty provides TTY for stin/stout for git-bash
  # see https://github.com/rprichard/winpty
  CMD_PREFIX='winpty'
  # Escape path conversion on Windows. 
  # See https://stackoverflow.com/questions/50608301
  PATH_PREFIX='/'
elif [[ `uname` == 'Linux' ]]; then
  # This will fix the issue on Linux, because weâ€™ll be running as the same user in both the container and the host.
  # Any files created by the container will be owned by the correct user now.
  USER_ARG="-e LOCAL_USER_ID=`id -u`"
fi

$CMD_PREFIX docker run -it --rm \
    ${USER_ARG} \
    -v "$PATH_PREFIX$(pwd)":/workdir \
    -v "${PATH_PREFIX}${HOME}/.composer":/home/user/.composer \
    -w $PATH_PREFIX/workdir \
    chekote/php:7.2.14-laravel5.7 \
    php "$@"

